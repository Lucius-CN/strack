!function(Ae){Ae.Jcrop=function(e,t){function g(e){return Math.round(e)+"px"}function b(e){return S.baseClass+"-"+e}function u(e){var t=Ae(e).offset();return[t.left,t.top]}function n(e){return[e.pageX-C[0],e.pageY-C[1]]}function o(e){"object"!=typeof e&&(e={}),S=Ae.extend(S,e),Ae.each(["onChange","onSelect","onRelease","onDblClick"],function(e,t){"function"!=typeof S[t]&&(S[t]=function(){})})}function a(e,t,n){if(C=u(D),ge.setCursor("move"===e?e:e+"-resize"),"move"===e)return ge.activateHandlers((o=t,be.watchKeys(),function(e){he.moveOffset([e[0]-o[0],e[1]-o[1]]),o=e,pe.update()}),l,n);var o,a,i,r=he.getFixed(),s=d(e),c=he.getCorner(d(s));he.setPressed(he.getCorner(s)),he.setCurrent(c),ge.activateHandlers((a=e,i=r,function(e){if(S.aspectRatio)switch(a){case"e":case"w":e[1]=i.y+1;break;case"n":e[0]=i.x+1;break;case"s":e[0]=i.x+1}else switch(a){case"e":case"w":e[1]=i.y2;break;case"n":e[0]=i.x2;break;case"s":e[0]=i.x2}he.setCurrent(e),pe.update()}),l,n)}function d(e){switch(e){case"n":return"sw";case"s":case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function w(t){return function(e){return S.disabled||"move"===t&&!S.allowMove||(C=u(D),X=!0,a(t,n(e)),e.stopPropagation(),e.preventDefault()),!1}}function s(e,t,n){var o=e.width(),a=e.height();t<o&&0<t&&(a=(o=t)/e.width()*e.height()),n<a&&0<n&&(o=(a=n)/e.height()*e.width()),q=e.width()/o,L=e.height()/a,e.width(o).height(a)}function v(e){return{x:e.x*q,y:e.y*L,x2:e.x2*q,y2:e.y2*L,w:e.w*q,h:e.h*L}}function l(){var e=he.getFixed();e.w>S.minSelect[0]&&e.h>S.minSelect[1]?(pe.enableHandles(),pe.done()):pe.release(),ge.setCursor(S.allowSelect?"crosshair":"default")}function i(e){if(!S.disabled&&S.allowSelect){X=!0,C=u(D),pe.disableHandles(),ge.setCursor("crosshair");var t=n(e);return he.setPressed(t),pe.update(),ge.activateHandlers(r,l,"touch"===e.type.substring(0,5)),be.watchKeys(),e.stopPropagation(),e.preventDefault(),!1}}function r(e){he.setCurrent(e),pe.update()}function y(){var e=Ae("<div></div>").addClass(b("tracker"));return z&&e.css({opacity:0,backgroundColor:"white"}),e}function c(e){m([e[0]/q,e[1]/L,e[2]/q,e[3]/L]),S.onSelect.call(Je,v(he.getFixed())),pe.enableHandles()}function m(e){he.setPressed([e[0],e[1]]),he.setCurrent([e[2],e[3]]),pe.update()}function h(){S.disabled=!0,pe.disableHandles(),pe.setCursor("default"),ge.setCursor("default")}function f(){S.disabled=!1,x()}function p(e,t,n){var o=t||S.bgColor;S.bgFade&&Ae.fx.step.hasOwnProperty("backgroundColor")&&S.fadeTime&&!n?e.animate({backgroundColor:o},{queue:!1,duration:S.fadeTime}):e.css("backgroundColor",o)}function x(e){S.allowResize?e?pe.enableOnly():pe.enableHandles():pe.disableHandles(),ge.setCursor(S.allowSelect?"crosshair":"default"),pe.setCursor(S.allowMove?"move":"default"),S.hasOwnProperty("trueSize")&&(q=S.trueSize[0]/I,L=S.trueSize[1]/B),S.hasOwnProperty("setSelect")&&(c(S.setSelect),pe.done(),delete S.setSelect),fe.refresh(),S.bgColor!=Q&&(p(S.shade?fe.getShades():P,S.shade&&S.shadeColor||S.bgColor),Q=S.bgColor),U!=S.bgOpacity&&(U=S.bgOpacity,S.shade?fe.refresh():pe.setBgOpacity(U)),K=S.maxSize[0]||0,E=S.maxSize[1]||0,W=S.minSize[0]||0,Y=S.minSize[1]||0,S.hasOwnProperty("outerImage")&&(D.attr("src",S.outerImage),delete S.outerImage),pe.refresh()}var C,S=Ae.extend({},Ae.Jcrop.defaults),k=navigator.userAgent.toLowerCase(),z=/msie/.test(k),M=/msie [1-6]\./.test(k);"object"!=typeof e&&(e=Ae(e)[0]),"object"!=typeof t&&(t={}),o(t);var O={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute"},j=Ae(e),F=!0;if("IMG"==e.tagName){if(0!=j[0].width&&0!=j[0].height)j.width(j[0].width),j.height(j[0].height);else{var H=new Image;H.src=j[0].src,j.width(H.width),j.height(H.height)}var D=j.clone().removeAttr("id").css(O).show();D.width(j.width()),D.height(j.height()),j.after(D).hide()}else D=j.css(O).show(),F=!1,null===S.shade&&(S.shade=!0);s(D,S.boxWidth,S.boxHeight);var I=D.width(),B=D.height(),P=Ae("<div />").width(I).height(B).addClass(b("holder")).css({position:"absolute",top:Ae(e).css("top"),left:Ae(e).css("left")}).insertAfter(j).append(D);S.addClass&&P.addClass(S.addClass);var J=Ae("<div />"),A=Ae("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),R=Ae("<div />").width("100%").height("100%").css("zIndex",320),T=Ae("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var e=he.getFixed();S.onDblClick.call(Je,e)}).insertBefore(D).append(A,R);F&&(J=Ae("<img />").attr("src",D.attr("src")).css(O).width(I).height(B),A.append(J)),M&&T.css({overflowY:"hidden"});var K,E,W,Y,q,L,X,G,N=S.boundary,V=y().width(I+2*N).height(B+2*N).css({position:"absolute",top:g(-N),left:g(-N),zIndex:290}).mousedown(i),Q=S.bgColor,U=S.bgOpacity;C=u(D);var Z,$,_,ee,te,ne,oe,ae,ie,re,se,ce,ue,de,le={createDragger:function(t){return function(e){return S.disabled||"move"===t&&!S.allowMove||(C=u(D),X=!0,a(t,n(le.cfilter(e)),!0),e.stopPropagation(),e.preventDefault()),!1}},newSelection:function(e){return i(le.cfilter(e))},cfilter:function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e},isSupported:Pe,support:!0===S.touchSupport||!1===S.touchSupport?S.touchSupport:Pe()},he=(de=ue=ce=se=0,{flipCoords:Ie,setPressed:function(e){e=De(e),ue=se=e[0],de=ce=e[1]},setCurrent:function(e){e=De(e),ie=e[0]-ue,re=e[1]-de,ue=e[0],de=e[1]},getOffset:function(){return[ie,re]},moveOffset:function(e){var t=e[0],n=e[1];se+t<0&&(t-=t+se),ce+n<0&&(n-=n+ce),B<de+n&&(n+=B-(de+n)),I<ue+t&&(t+=I-(ue+t)),se+=t,ue+=t,ce+=n,de+=n},getCorner:function(e){var t=He();switch(e){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}},getFixed:He}),fe=(ne=!1,oe=Ae("<div />").css({position:"absolute",zIndex:240,opacity:0}),ae={top:ke(),left:ke().height(B),right:ke().height(B),bottom:ke()},{update:Ce,updateRaw:Se,getShades:Fe,setBgColor:Me,enable:ze,disable:Oe,resize:function(e,t){ae.left.css({height:g(t)}),ae.right.css({height:g(t)})},refresh:function(){(S.shade?ze:Oe)(),pe.isAwake()&&je(S.bgOpacity)},opacity:je}),pe=function(){function i(e,t){var n=Ae("<div />").mousedown(w(e)).css({cursor:e+"-resize",position:"absolute",zIndex:t}).addClass("ord-"+e);return le.support&&n.bind("touchstart.jcrop",le.createDragger(e)),R.append(n),n}function e(){var e=he.getFixed();he.setPressed([e.x,e.y]),he.setCurrent([e.x2,e.y2]),t()}function t(e){return c?n(e):void 0}function n(e){var t,n,o,a,i=he.getFixed();o=i.w,a=i.h,T.width(Math.round(o)).height(Math.round(a)),t=i.x,n=i.y,S.shade||J.css({top:g(-n),left:g(-t)}),T.css({top:g(n),left:g(t)}),S.shade&&fe.updateRaw(i),c||(T.show(),S.shade?fe.opacity(U):r(U,!0),c=!0),e?S.onSelect.call(Je,v(i)):S.onChange.call(Je,v(i))}function r(e,t,n){(c||t)&&(S.bgFade&&!n?D.animate({opacity:e},{queue:!1,duration:S.fadeTime}):D.css("opacity",e))}function o(){return f=!0,S.allowResize?(R.show(),!0):void 0}function a(){f=!1,R.hide()}function s(e){e?(G=!0,a()):(G=!1,o())}var c,u=370,d={},l={},h={},f=!1;S.dragEdges&&Ae.isArray(S.createDragbars)&&function(e){var t;for(t=0;t<e.length;t++)h[e[t]]=i(e[t],u++).addClass("jcrop-dragbar")}(S.createDragbars),Ae.isArray(S.createHandles)&&function(e){var t,n,o,a;for(t=0;t<e.length;t++)l[e[t]]=(n=e[t],a=void 0,o=S.handleSize,a=i(n,u++).css({opacity:S.handleOpacity}).addClass(b("handle")),o&&a.width(o).height(o),a)}(S.createHandles),S.drawBorders&&Ae.isArray(S.createBorders)&&function(e){var t,n,o,a;for(n=0;n<e.length;n++){switch(e[n]){case"n":t="hline";break;case"s":t="hline bottom";break;case"e":t="vline right";break;case"w":t="vline"}d[e[n]]=(o=t,a=Ae("<div />").css({position:"absolute",opacity:S.borderOpacity}).addClass(b(o)),A.append(a),a)}}(S.createBorders),Ae(document).bind("touchstart.jcrop-ios",function(e){Ae(e.currentTarget).hasClass("jcrop-tracker")&&e.stopPropagation()});var p=y().mousedown(w("move")).css({cursor:"move",position:"absolute",zIndex:360});return le.support&&p.bind("touchstart.jcrop",le.createDragger("move")),A.append(p),a(),{updateVisible:t,update:n,release:function(){a(),T.hide(),S.shade?fe.opacity(1):r(1),c=!1,S.onRelease.call(Je)},refresh:e,isAwake:function(){return c},setCursor:function(e){p.css("cursor",e)},enableHandles:o,enableOnly:function(){f=!0},showHandles:function(){f&&R.show()},disableHandles:a,animMode:s,setBgOpacity:r,done:function(){s(!1),e()}}}(),ge=(_=function(){},ee=function(){},(te=S.trackDocument)||V.mousemove(ve).mouseup(ye).mouseout(ye),D.before(V),{activateHandlers:function(e,t,n){return X=!0,_=e,ee=t,o=n,V.css({zIndex:450}),o?Ae(document).bind("touchmove.jcrop",me).bind("touchend.jcrop",xe):te&&Ae(document).bind("mousemove.jcrop",ve).bind("mouseup.jcrop",ye),!1;var o},setCursor:function(e){V.css("cursor",e)}}),be=(Z=Ae('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),$=Ae("<div />").css({position:"absolute",overflow:"hidden"}).append(Z),S.keySupport&&(Z.keydown(function(e){if(e.ctrlKey||e.metaKey)return!0;var t=!!e.shiftKey?10:1;switch(e.keyCode){case 37:we(e,-t,0);break;case 39:we(e,t,0);break;case 38:we(e,0,-t);break;case 40:we(e,0,t);break;case 27:S.allowSelect&&pe.release();break;case 9:return!0}return!1}).blur(function(){Z.hide()}),M||!S.fixedSupport?(Z.css({position:"absolute",left:"-20px"}),$.append(Z).insertBefore(D)):Z.insertBefore(D)),{watchKeys:function(){S.keySupport&&(Z.show(),Z.focus())}});function we(e,t,n){S.allowMove&&(he.moveOffset([t,n]),pe.updateVisible(!0)),e.preventDefault(),e.stopPropagation()}function ve(e){return _(n(e)),!1}function ye(e){return e.preventDefault(),e.stopPropagation(),X&&(X=!1,ee(n(e)),pe.isAwake()&&S.onSelect.call(Je,v(he.getFixed())),V.css({zIndex:290}),Ae(document).unbind(".jcrop"),_=function(){},ee=function(){}),!1}function me(e){return _(n(le.cfilter(e))),!1}function xe(e){return ye(le.cfilter(e))}function Ce(){return Se(he.getFixed())}function Se(e){ae.top.css({left:g(e.x),width:g(e.w),height:g(e.y)}),ae.bottom.css({top:g(e.y2),left:g(e.x),width:g(e.w),height:g(B-e.y2)}),ae.right.css({left:g(e.x2),width:g(I-e.x2)}),ae.left.css({width:g(e.x)})}function ke(){return Ae("<div />").css({position:"absolute",backgroundColor:S.shadeColor||S.bgColor}).appendTo(oe)}function ze(){ne||(ne=!0,oe.insertBefore(D),Ce(),pe.setBgOpacity(1,0,1),J.hide(),Me(S.shadeColor||S.bgColor,1),pe.isAwake()?je(S.bgOpacity,1):je(1,1))}function Me(e,t){p(Fe(),e,t)}function Oe(){ne&&(oe.remove(),J.show(),ne=!1,pe.isAwake()?pe.setBgOpacity(S.bgOpacity,1,1):(pe.setBgOpacity(1,1,1),pe.disableHandles()),p(P,0,1))}function je(e,t){ne&&(S.bgFade&&!t?oe.animate({opacity:1-e},{queue:!1,duration:S.fadeTime}):oe.css({opacity:1-e}))}function Fe(){return oe.children()}function He(){if(!S.aspectRatio)return t=ue-se,n=de-ce,K&&Math.abs(t)>K&&(ue=0<t?se+K:se-K),E&&Math.abs(n)>E&&(de=0<n?ce+E:ce-E),Y/L&&Math.abs(n)<Y/L&&(de=0<n?ce+Y/L:ce-Y/L),W/q&&Math.abs(t)<W/q&&(ue=0<t?se+W/q:se-W/q),se<0&&(ue-=se,se-=se),ce<0&&(de-=ce,ce-=ce),ue<0&&(se-=ue,ue-=ue),de<0&&(ce-=de,de-=de),I<ue&&(se-=e=ue-I,ue-=e),B<de&&(ce-=e=de-B,de-=e),I<se&&(de-=e=se-B,ce-=e),B<ce&&(de-=e=ce-B,ce-=e),Be(Ie(se,ce,ue,de));var e,t,n,o,a,i,r,s=S.aspectRatio,c=S.minSize[0]/q,u=S.maxSize[0]/q,d=S.maxSize[1]/L,l=ue-se,h=de-ce,f=Math.abs(l),p=Math.abs(h);return 0===u&&(u=10*I),0===d&&(d=10*B),f/p<s?(a=de,i=p*s,(o=l<0?se-i:i+se)<0?(o=0,r=Math.abs((o-se)/s),a=h<0?ce-r:r+ce):I<o&&(o=I,r=Math.abs((o-se)/s),a=h<0?ce-r:r+ce)):(o=ue,r=f/s,(a=h<0?ce-r:ce+r)<0?(a=0,i=Math.abs((a-ce)*s),o=l<0?se-i:i+se):B<a&&(a=B,i=Math.abs(a-ce)*s,o=l<0?se-i:i+se)),se<o?(o-se<c?o=se+c:u<o-se&&(o=se+u),a=ce<a?ce+(o-se)/s:ce-(o-se)/s):o<se&&(se-o<c?o=se-c:u<se-o&&(o=se-u),a=ce<a?ce+(se-o)/s:ce-(se-o)/s),o<0?(se-=o,o=0):I<o&&(se-=o-I,o=I),a<0?(ce-=a,a=0):B<a&&(ce-=a-B,a=B),Be(Ie(se,ce,o,a))}function De(e){return e[0]<0&&(e[0]=0),e[1]<0&&(e[1]=0),e[0]>I&&(e[0]=I),e[1]>B&&(e[1]=B),[Math.round(e[0]),Math.round(e[1])]}function Ie(e,t,n,o){var a=e,i=n,r=t,s=o;return n<e&&(a=n,i=e),o<t&&(r=o,s=t),[a,r,i,s]}function Be(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}function Pe(){var e,t={},n=["touchstart","touchmove","touchend"],o=document.createElement("div");try{for(e=0;e<n.length;e++){var a=n[e],i=(a="on"+a)in o;i||(o.setAttribute(a,"return;"),i="function"==typeof o[a]),t[n[e]]=i}return t.touchstart&&t.touchend&&t.touchmove}catch(e){return!1}}le.support&&V.bind("touchstart.jcrop",le.newSelection),R.hide(),x(!0);var Je={setImage:function(a,i){pe.release(),h();var r=new Image;r.onload=function(){var e=r.width,t=r.height,n=S.boxWidth,o=S.boxHeight;D.width(e).height(t),D.attr("src",a),J.attr("src",a),s(D,n,o),I=D.width(),B=D.height(),J.width(I).height(B),V.width(I+2*N).height(B+2*N),P.width(I).height(B),fe.resize(I,B),f(),"function"==typeof i&&i.call(Je)},r.src=a},animateTo:function(e,t){function n(){window.setTimeout(v,l)}var o=e[0]/q,a=e[1]/L,i=e[2]/q,r=e[3]/L;if(!G){var s=he.flipCoords(o,a,i,r),c=he.getFixed(),u=[c.x,c.y,c.x2,c.y2],d=u,l=S.animationDelay,h=s[0]-u[0],f=s[1]-u[1],p=s[2]-u[2],g=s[3]-u[3],b=0,w=S.swingSpeed;o=d[0],a=d[1],i=d[2],r=d[3],pe.animMode(!0);var v=function(){b+=(100-b)/w,d[0]=Math.round(o+b/100*h),d[1]=Math.round(a+b/100*f),d[2]=Math.round(i+b/100*p),d[3]=Math.round(r+b/100*g),99.8<=b&&(b=100),b<100?(m(d),n()):(pe.done(),pe.animMode(!1),"function"==typeof t&&t.call(Je))};n()}},setSelect:c,setOptions:function(e){o(e),x()},tellSelect:function(){return v(he.getFixed())},tellScaled:function(){return he.getFixed()},setClass:function(e){P.removeClass().addClass(b("holder")).addClass(e)},disable:h,enable:f,cancel:function(){pe.done(),ge.activateHandlers(null,null)},release:pe.release,destroy:function(){P.remove(),j.show(),j.css("visibility","visible"),Ae(e).removeData("Jcrop")},focus:be.watchKeys,getBounds:function(){return[I*q,B*L]},getWidgetSize:function(){return[I,B]},getScaleFactor:function(){return[q,L]},getOptions:function(){return S},ui:{holder:P,selection:T}};return z&&P.bind("selectstart",function(){return!1}),j.data("Jcrop",Je),Je},Ae.fn.Jcrop=function(e,t){var n;return this.each(function(){if(Ae(this).data("Jcrop")){if("api"===e)return Ae(this).data("Jcrop");Ae(this).data("Jcrop").setOptions(e)}else"IMG"==this.tagName?Ae.Jcrop.Loader(this,function(){Ae(this).css({display:"block",visibility:"hidden"}),n=Ae.Jcrop(this,e),Ae.isFunction(t)&&t.call(n)}):(Ae(this).css({display:"block",visibility:"hidden"}),n=Ae.Jcrop(this,e),Ae.isFunction(t)&&t.call(n))}),this},Ae.Jcrop.Loader=function(e,t,n){var o=Ae(e),a=o[0];o.bind("load.jcloader",function e(){a.complete?(o.unbind(".jcloader"),Ae.isFunction(t)&&t.call(a)):window.setTimeout(e,50)}).bind("error.jcloader",function(){o.unbind(".jcloader"),Ae.isFunction(n)&&n.call(a)}),a.complete&&Ae.isFunction(t)&&(o.unbind(".jcloader"),t.call(a))},Ae.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery);